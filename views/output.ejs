<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
        <title>Water Quality Assessment | Output</title>
        <link rel = "icon" href = "/img/logo.png" type = "image/x-icon">
        <link rel="stylesheet" href="/styles/output.style.css">
        <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin=""/>
    </head>
    <body>
        <nav class="navbar navbar-light py-0">
            <div class="container d-flex align-items-center justify-content-between px-xs-1 py-2">
                <div class="col-xs-7 px-xs-0 w-auto">
                    <a href="#"><img src="/img/logo.png" alt="Water Quality Index" height="85"></a>
                </div>
                <div class="container d-flex w-auto justify-content-between mx-0 px-0">
                    <div class="col-xs-1 px-xs-0 w-25">
                        <img src="/img/iit-logo.png" alt="IITKGP-logo" height="80">
                    </div>
                    <div class="col-xs-4 d-flex flex-column align-items-center justify-content-start px-xs-0 w-100">
                        <span style="font-weight: bold; color: white;">Agricultural and Food Engineering</span>
                        <br>
                        <span style="color: white;">Indian Institute of Technology</span>
                        <br>
                        <span style="color: white;">Kharagpur</span>
                    </div>
                </div>
            </div>
        </nav>
        <main>
            <div class="container border text-center">
                <h3 class="fw-bold p-2">Water Quality Status</h3>
            </div>
            <div class="container d-flex flex-column">
                <div class="row w-100 text-center mt-3 text-white bg-primary align-self-center">
                    <h3 class="wqi_header">Location on map</h3>
                </div>
                <div id="siteMap" style="height: 33rem;"></div>
            </div>
            <div class="container d-flex flex-column align-items-center mt-3">
                <div class="row w-100 text-center mt-3 text-white bg-primary">
                    <h3 class="wqi_header">WQI with location</h3>
                </div>
                <table class="table text-lg-center table-striped table-bordered table-responsive-sm table-1">
                    <thead>
                        <tr class="t-h">
                            <th scope="col">Sl no.</th>
                            <th scope="col">Address</th>
                            <th scope="col">Latitude</th>
                            <th scope="col">Longitude</th>
                            <th scope="col">WQI</th>
                            <th scope="col">Class</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
            
            <div class="container d-flex flex-column align-items-center">
                <div class="row w-100 text-center mt-3 text-white bg-primary">
                    <h3 class="wqi_header">WQI Classification</h3>
                </div>
                <table class="table text-center text-wrap">
                    <thead>
                        <tr class="t-h">
                            <th scope="col">WQI</th>
                            <th scope="col">Water Quality</th>
                            <th scope="col">Grading</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="t-1">
                            <td>0 - 25</td>
                            <td>Excellent</td>
                            <td>A</td>
                        </tr>
                        <tr class="t-2">
                            <td>26 - 50</td>
                            <td>Good</td>
                            <td>B</td>
                        </tr>
                        <tr class="t-3">
                            <td>51 - 75</td>
                            <td>Poor</td>
                            <td>C</td>
                        </tr>
                        <tr class="t-4">
                            <td>76 - 100</td>
                            <td>Very Poor</td>
                            <td>D</td>
                        </tr>
                        <tr class="t-5">
                            <td>> 100</td>
                            <td>Unsuitable for drinking</td>
                            <td>E</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
        <footer class="page-footer font-small blue fixed-bottom ">
            <div class="footer-copyright text-center py-3 text-light">
                Â© 2021 Copyright : Water Quality Index
            </div>
        </footer>

        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

        <script>
            var json = JSON.parse(localStorage.getItem('json'));
            // console.log(json.wqi_list);
            var tbody = document.getElementById("tbody");
            var bg_color = 'bg-white';
            for (var i = 0; i < json.wqi_list.length; i++) {
                if (json.wqi_list[i] >= 0 && json.wqi_list[i] <= 25) {
                    var wqi_class = 'Excellent';
                    bg_color = 't-1';
                }
                else if (json.wqi_list[i] > 25 && json.wqi_list[i] <= 50) {
                    var wqi_class = 'Good';
                    bg_color = 't-2';
                }
                else if (json.wqi_list[i] > 50 && json.wqi_list[i] <= 75) {
                    var wqi_class = 'Poor';
                    bg_color = 't-3';
                }
                else if (json.wqi_list[i] > 75 && json.wqi_list[i] <= 100) {
                    var wqi_class = 'Very Poor';
                    bg_color = 't-4';
                }
                else if (json.wqi_list[i] > 100) {
                    var wqi_class = 'Unsuitable for drinking';
                    bg_color = 't-5';
                }
                html = '<tr class='+ bg_color +'>\
                            <td>'+ (i + 1) +'</td>\
                            <td>'+ json.data[i].address +'</td>\
                            <td>'+ json.data[i].latitude +'</td>\
                            <td>'+ json.data[i].longitude +'</td>\
                            <td>'+ json.wqi_list[i] +'</td>\
                            <td>'+ wqi_class +'</td>\
                        </tr>';
                tbody.innerHTML += html;
            }
            //map
            var map = L.map('siteMap').setView([json.data[0].latitude, json.data[0].longitude], 5);
            var redIcon = L.icon({
                iconUrl: '/img/red_dot.png',
                iconSize: [100, 100],
            });
            var darkGreenIcon = L.icon({
                iconUrl: '/img/darkGreen_dot.png',
                iconSize: [100, 100],
            });
            var lightGreenIcon = L.icon({
                iconUrl: '/img/lightGreen_dot.png',
                iconSize: [100, 100],
            });
            var yellowIcon = L.icon({
                iconUrl: '/img/yellow_dot.png',
                iconSize: [100, 100],
            });
            var orangeIcon = L.icon({
                iconUrl: '/img/orange_dot.png',
                iconSize: [100, 100],
            });
            const attribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
            const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
            const tiles = L.tileLayer(tileUrl, { attribution });
            tiles.addTo(map);
            for (var i = 0; i < json.wqi_list.length; i++) {
                if (json.wqi_list[i] >= 0 && json.wqi_list[i] <= 25) {
                    L.marker([json.data[i].latitude, json.data[i].longitude], {icon: darkGreenIcon}).addTo(map);
                }
                else if (json.wqi_list[i] > 25 && json.wqi_list[i] <= 50) {
                    L.marker([json.data[i].latitude, json.data[i].longitude], {icon: lightGreenIcon}).addTo(map);
                }
                else if (json.wqi_list[i] > 50 && json.wqi_list[i] <= 75) {
                    L.marker([json.data[i].latitude, json.data[i].longitude], {icon: yellowIcon}).addTo(map);
                }
                else if (json.wqi_list[i] > 75 && json.wqi_list[i] <= 100) {
                    L.marker([json.data[i].latitude, json.data[i].longitude], {icon: orangeIcon}).addTo(map);
                }
                else if (json.wqi_list[i] > 100) {
                    L.marker([json.data[i].latitude, json.data[i].longitude], {icon: redIcon}).addTo(map);
                }
            }

            window.localStorage.clear();
        </script>

        <script src="/scripts/output.js"></script>
        <script src="/bootstrap/js/bootstrap.js"></script>
    </body>
</html>